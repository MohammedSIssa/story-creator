<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Story Creator</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

    <style>
      * {
        margin: 0;
        box-sizing: border-box;
      }
      button {
        z-index: 1000;
        font-family: "ReadexPro", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        filter: drop-shadow(0 4px 10px rgba(1, 1, 1, 0.5));
      }
      button img {
        width: 50px !important;
        height: 50px !important;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100dvh;
        margin: 0;
        background: black;
        padding: 20px;
      }
      .container {
        /* width: 383px; height: 680px; */
        height: 90dvh;
        width: auto;
        aspect-ratio: 9 / 16;
        background: white;
        position: relative;
        border-radius: 15px;
        overflow: hidden;
        background-position: center !important;
        background-size: cover !important;
        object-fit: cover !important;
      }

      .add-text {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: transparent;
        width: 50px;
        height: 50px;
        cursor: pointer;
        border-radius: 50%;
        border: 0;
        font-family: "ReadexPro", sans-serif;
      }
      .textbox {
        /* border: 1px solid #a2a2a2; */
        direction: rtl;
        padding: 10px 22px !important;
        text-align: center;
        position: absolute;
        background: rgba(0, 0, 0, 0.33);
        color: white;
        padding: 5px;
        border-radius: 5px;
        cursor: grab;
        min-width: 100px;
        max-width: 90% !important;
        min-height: 20px;
        font-family: "Rubik", sans-serif;
      }
      .change-bg {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 0;
        background-color: transparent;
        cursor: pointer;
      }

      .dropdown {
        position: absolute;
        top: 70px;
        left: 10px;
        background: white;
        border: 1px solid #ccc;
        display: none;
        flex-direction: column;
      }
      .dropdown button {
        background: none;
        border: none;
        padding: 5px;
        cursor: pointer;
        text-align: left;
      }
      .bg-dropdown {
        position: absolute;
        width: 50px;
        top: 70px;
        right: 10px;
        background: white;
        border: 1px solid #ccc;
        display: none;
        flex-direction: column;
      }
      .bg-dropdown button {
        background: none;
        border: none;
        padding: 5px;
        cursor: pointer;
        text-align: left;
      }
      .dropdown,
      .bg-dropdown {
        z-index: 1000;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
      }
      .dropdown button,
      .bg-dropdown button {
        background: transparent;
        border: none;
        padding: 10px;
        cursor: pointer;
        text-align: center;
        color: white;
        font-size: 16px;
        width: 100%;
        transition: background 0.3s ease;
        border-bottom: 1px solid rgba(222, 222, 222, 0.6);
      }
      .dropdown button:last-child,
      .bg-dropdown button:last-child {
        border: 0;
      }
      .dropdown button:hover,
      .bg-dropdown button:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .bg-default {
        background: black;
      }
      .bg-pink {
        background: linear-gradient(45deg, #ff9a9e, #fad0c4);
      }
      .bg-blue {
        background: linear-gradient(45deg, #56ccf2, #2f80ed);
      }
      .bg-light {
        background: #eee;
        color: #222;
      }
      .bg-sky {
        background: url("https://i.imgur.com/1JMKidV.jpeg");
      }
      .bg-img {
        background: url("./image.jpg");
      }
      .bg-watermelon {
        background: url("https://i.imgur.com/IMvmQMM.jpeg");
      }

      #bgMovable {
        position: absolute;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        cursor: grab;
        user-select: none;
        border-radius: 12px;
      }
      #bgMovable:active {
        cursor: grabbing;
      }

      p,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        text-wrap: pretty;
        line-height: 1.5;
      }
    </style>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <button
      class="saveBtn"
      id="save-img-btn"
      style="
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        background-color: transparent;
        border: 0;
        display: block !important;
      "
    >
    </button>
    <div class="container bg-pink" id="storyContainer">
      <div id="bgMovable"></div>
      <div id="customBgPopup" class="popup">
        <input
          type="text"
          id="imgurUrlInput"
          placeholder="Enter Imgur Image URL"
        />
        <button onclick="setCustomBackground()">Apply</button>
        <button onclick="toggleCustomBgPopup()">Close</button>
      </div>
      <button
        class="add-text"
        onclick="toggleDropdown()"
        style="font-size: 24px; font-family: system-ui, sans-serif !important"
      >
        <img src="./text.svg" alt="" />
      </button>
      <div class="dropdown" id="dropdown">
        <button onclick="addTextBox('h1')" style="font-size: 32px">ŸÜÿµ 1</button>
        <button onclick="addTextBox('h2')" style="font-size: 24px">ŸÜÿµ 2</button>
        <button onclick="addTextBox('h3')" style="font-size: 20px">ŸÜÿµ 3</button>
        <button onclick="addTextBox('h4')" style="font-size: 16px">ŸÜÿµ 4</button>
        <button onclick="addTextBox('h5')" style="font-size: 14px">ŸÜÿµ 5</button>
        <button onclick="addTextBox('h6')" style="font-size: 12px">ŸÜÿµ 6</button>
        <button onclick="addTextBox('p')" style="font-size: 10px">ŸÜÿµ 7</button>
      </div>
      <button class="change-bg" onclick="toggleBgDropdown()">
        <img src="./img.svg" alt="" />
      </button>
      <div class="bg-dropdown" id="bgDropdown" style="width: fit-content">
        <button onclick="changeBackground(0)">ü§ç</button>
        <button onclick="changeBackground(1)">ü©∑</button>
        <button onclick="changeBackground(2)">üíô</button>
        <button onclick="changeBackground(3)">üåö</button>
        <button onclick="changeBackground(4)">üçâ</button>
        <button onclick="changeBackground(5)">üåÉ</button>
        <button onclick="toggleCustomBgPopup()">Custom</button>
      </div>
      <button class="font-family-btn" onclick="toggleFontDropdown()">
        <img src="./font.svg" alt="" />
      </button>
      <div class="font-dropdown" id="fontDropdown">
        <button
          onclick="changeFont('ReadexPro, sans-serif')"
          style="
            font-family: 'ReadexPro' !important;
            font-size: 18px;
            font-weight: 500;
          "
        >
          ÿ±ŸäÿØŸÉÿ≥ ÿ®ÿ±Ÿà
        </button>
        <button
          onclick="changeFont('Rubik, sans-serif')"
          style="
            font-family: Rubik !important;
            font-size: 18px;
            font-weight: 500;
          "
        >
          ÿ±Ÿàÿ®ŸäŸÉ
        </button>
      </div>
    </div>
    <script>
      const backgrounds = [
        { className: "bg-light" },
        { className: "bg-pink" },
        { className: "bg-blue" },
        { className: "bg-default" },
        { className: "bg-watermelon" },
        { className: "bg-sky" },
        { className: "" },
      ];

      function toggleBgDropdown() {
        const bgDropdown = document.getElementById("bgDropdown");
        bgDropdown.style.display =
          bgDropdown.style.display === "flex" ? "none" : "flex";
      }

      function changeBackground(index) {
        const container = document.getElementById("storyContainer");
        container.className = `container ${backgrounds[index].className}`;
        toggleBgDropdown();
      }

      function toggleDropdown() {
        const dropdown = document.getElementById("dropdown");
        dropdown.style.display =
          dropdown.style.display === "flex" ? "none" : "flex";
      }

      function isMobile() {
        return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      }

      function addTextBox(tag) {
        const container = document.getElementById("storyContainer");
        const textBox = document.createElement(tag);
        textBox.classList.add("textbox");
        textBox.innerText = isMobile() ? "" : "ŸÜÿµ ÿ¨ÿØŸäÿØ";
        textBox.style.left = "5%";
        textBox.style.top = "80px";
        container.appendChild(textBox);
        toggleDropdown();
        dragElement(textBox);
        enableEditing(textBox);
      }

      function dragElement(el) {
        let startX, startY, initialX, initialY;

        function startDrag(event) {
          event.preventDefault();
          startX = event.type.includes("touch")
            ? event.touches[0].clientX
            : event.clientX;
          startY = event.type.includes("touch")
            ? event.touches[0].clientY
            : event.clientY;
          initialX = el.offsetLeft;
          initialY = el.offsetTop;
          document.addEventListener("mousemove", drag);
          document.addEventListener("mouseup", stopDrag);
          document.addEventListener("touchmove", drag);
          document.addEventListener("touchend", stopDrag);
        }

        function drag(event) {
          let clientX = event.type.includes("touch")
            ? event.touches[0].clientX
            : event.clientX;
          let clientY = event.type.includes("touch")
            ? event.touches[0].clientY
            : event.clientY;

          let deltaX = clientX - startX;
          let deltaY = clientY - startY;

          el.style.left = `${initialX + deltaX}px`;
          el.style.top = `${initialY + deltaY}px`;
        }

        function stopDrag() {
          document.removeEventListener("mousemove", drag);
          document.removeEventListener("mouseup", stopDrag);
          document.removeEventListener("touchmove", drag);
          document.removeEventListener("touchend", stopDrag);
        }

        el.addEventListener("mousedown", startDrag);
        el.addEventListener("touchstart", startDrag);
      }

      function enableEditing(el) {
        function startEditing() {
          el.contentEditable = true;
          el.focus();
        }

        function stopEditing() {
          el.contentEditable = false;
        }

        el.addEventListener("dblclick", startEditing);
        el.addEventListener("touchstart", startEditing, { passive: true }); // ŸäÿπŸÖŸÑ ÿπŸÜÿØ ÿßŸÑŸÑŸÖÿ≥ ÿπŸÑŸâ ÿßŸÑŸáÿßÿ™ŸÅ
        el.addEventListener("click", startEditing);

        el.addEventListener("blur", stopEditing);
      }

      function toggleFontDropdown() {
        const fontDropdown = document.getElementById("fontDropdown");
        fontDropdown.style.display =
          fontDropdown.style.display === "flex" ? "none" : "flex";
      }

      function changeFont(font) {
        const textElements = document.querySelectorAll(".textbox");
        textElements.forEach((el) => {
          el.style.fontFamily = font;
        });
        toggleFontDropdown();
      }

      document.addEventListener("contextmenu", function (event) {
        event.preventDefault(); // Prevents scrolling down on spacebar press
        document.querySelectorAll("button").forEach((button) => {
          if (!button.classList.contains("saveBtn")) {
            button.style.display =
              button.style.display === "none" ? "block" : "none";
          }
        });
      });
      function toggleCustomBgPopup() {
        const popup = document.getElementById("customBgPopup");
        popup.style.display = popup.style.display === "flex" ? "none" : "flex";
      }

      function setCustomBackground() {
        const input = document.getElementById("imgurUrlInput").value.trim();
        const bgMovable = document.getElementById("bgMovable");

        if (
          input.startsWith("http") &&
          (input.includes("imgur.com") ||
            input.includes(".jpg") ||
            input.includes(".png"))
        ) {
          bgMovable.style.backgroundImage = `url('${input}')`;
          toggleCustomBgPopup(); // Hide popup
        } else {
          alert("Please enter a valid Imgur image URL!");
        }
      }

      // Make background draggable
      function enableBgDragging() {
        const bg = document.getElementById("bgMovable");
        let startX, startY, initialX, initialY;

        function startDrag(event) {
          event.preventDefault();
          startX = event.type.includes("touch")
            ? event.touches[0].clientX
            : event.clientX;
          startY = event.type.includes("touch")
            ? event.touches[0].clientY
            : event.clientY;
          initialX = parseInt(bg.style.backgroundPositionX) || 0;
          initialY = parseInt(bg.style.backgroundPositionY) || 0;
          document.addEventListener("mousemove", drag);
          document.addEventListener("mouseup", stopDrag);
          document.addEventListener("touchmove", drag);
          document.addEventListener("touchend", stopDrag);
        }

        function drag(event) {
          let clientX = event.type.includes("touch")
            ? event.touches[0].clientX
            : event.clientX;
          let clientY = event.type.includes("touch")
            ? event.touches[0].clientY
            : event.clientY;

          let deltaX = clientX - startX;
          let deltaY = clientY - startY;

          bg.style.backgroundPositionX = `${initialX + deltaX}px`;
          bg.style.backgroundPositionY = `${initialY + deltaY}px`;
        }

        function stopDrag() {
          document.removeEventListener("mousemove", drag);
          document.removeEventListener("mouseup", stopDrag);
          document.removeEventListener("touchmove", drag);
          document.removeEventListener("touchend", stopDrag);
        }

        bg.addEventListener("mousedown", startDrag);
        bg.addEventListener("touchstart", startDrag);
      }

      // Call function to activate dragging
      enableBgDragging();

      let scale = 1;
      const bgMovable = document.getElementById("bgMovable");
      function zoomBackground(event) {
        event.preventDefault();
        const zoomFactor = 0.1;
        scale += event.deltaY < 0 ? zoomFactor : -zoomFactor;
        scale = Math.max(0.5, Math.min(3, scale));
        bgMovable.style.transform = `scale(${scale})`;
      }
      bgMovable.addEventListener("wheel", zoomBackground);
      let touchStartDistance = 0;
      function getDistance(touches) {
        const dx = touches[0].clientX - touches[1].clientX;
        const dy = touches[0].clientY - touches[1].clientY;
        return Math.sqrt(dx * dx + dy * dy);
      }
      bgMovable.addEventListener("touchstart", (event) => {
        if (event.touches.length === 2) {
          touchStartDistance = getDistance(event.touches);
        }
      });
      bgMovable.addEventListener("touchmove", (event) => {
        if (event.touches.length === 2) {
          event.preventDefault();
          const newDistance = getDistance(event.touches);
          const zoomFactor = 0.005;
          scale *= 1 + (newDistance - touchStartDistance) * zoomFactor;
          scale = Math.max(0.5, Math.min(3, scale));
          bgMovable.style.transform = `scale(${scale})`;
          touchStartDistance = newDistance;
        }
      });
    </script>
  </body>
</html>
